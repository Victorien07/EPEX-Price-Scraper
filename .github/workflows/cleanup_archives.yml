name: Cleanup Old Archives

on:
  schedule:
    - cron: "0 3 * * *" # tous les jours à 3h du matin
  workflow_dispatch:

jobs:
  cleanup:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Suppression des fichiers archivés > 30 jours
      run: |
        echo "🗑️ Suppression des fichiers archivés vieux de plus de 30 jours..."
        find archives/html/ -type f \( -name "*.html" -o -name "*.json" \) -mtime +30 -print -delete
        find archives/html_gaz/ -type f \( -name "*.html" -o -name "*.json" \) -mtime +30 -print -delete
        find archives/html_co2/ -type f \( -name "*.html" -o -name "*.json" \) -mtime +30 -print -delete

    - name: Commit & push changements
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"
        git add archives/
        git commit -m "🗑️ Nettoyage automatique des archives > 30 jours" || echo "Rien à commit"
        git push
